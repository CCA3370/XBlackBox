# XBlackBox - Flight Data Recorder for X-Plane 12

XBlackBox is a high-performance C++ plugin for X-Plane 12 that records comprehensive flight data in real-time, similar to a real aircraft's flight data recorder (black box).

## ğŸ†• What's New - Enhanced XDR Viewer

The XDR Viewer has been significantly enhanced with advanced analysis capabilities:

### Key Enhancements
- **ğŸ“Š Statistics Analysis**: Min/Max/Mean/Median/Std Dev for all parameters
- **ğŸ”— Correlation Analysis**: Discover relationships between parameters
- **ğŸ“ˆ Derivative Plotting**: Visualize rate of change (d/dt)
- **â±ï¸ Time Range Selection**: Focus on specific flight phases
- **âš¡ Performance Optimized**: Auto-downsampling for large datasets
- **âŒ¨ï¸ Keyboard Shortcuts**: Fast workflow navigation
- **ğŸ“‚ Recent Files**: Quick access to frequently used files
- **ğŸ–±ï¸ Drag & Drop**: Simple file opening

See [VIEWER_GUIDE.md](VIEWER_GUIDE.md) for complete documentation.

## Features

- **Real-time Recording**: Continuously records flight data at configurable intervals (20Hz to 0.2Hz)
- **Three Recording Levels**:
  - **Simple**: Basic flight data (position, attitude, velocities) - ~25 parameters
  - **Normal**: + flight controls, engines, systems - ~70 parameters  
  - **Detailed**: Everything including autopilot, weather, warnings, failures, etc. - ~230+ parameters
- **Efficient Binary Format**: Compact .xdr files for minimal disk usage and fast I/O
- **Optimized Performance**: Buffered binary I/O, efficient dataref caching
- **Auto Recording Mode**: Automatically starts/stops recording based on:
  - Ground speed threshold
  - Engine running state
  - Weight on wheels (takeoff/landing detection)
- **Menu Integration**: Full X-Plane plugins menu integration
- **Persistent Settings**: All configuration is saved and restored

## Installation

### Option 1: Download Pre-built Package (Recommended)

Pre-built packages are automatically generated by our CI system on each push to the main branch:

1. Go to the [GitHub Actions page](https://github.com/CCA3370/XBlackBox/actions/workflows/build.yml)
2. Click on the latest successful workflow run
3. Download the `XBlackBox-release` artifact
4. Extract `XBlackBox.zip` to your X-Plane 12 `Resources/plugins/` directory
5. The final structure should be:
   ```
   X-Plane 12/
   â””â”€â”€ Resources/
       â””â”€â”€ plugins/
           â””â”€â”€ XBlackBox/
               â”œâ”€â”€ win_x64/
               â”‚   â””â”€â”€ XBlackBox.xpl
               â”œâ”€â”€ mac_x64/
               â”‚   â””â”€â”€ XBlackBox.xpl
               â”œâ”€â”€ lin_x64/
               â”‚   â””â”€â”€ XBlackBox.xpl
               â”œâ”€â”€ README.txt
               â””â”€â”€ LICENSE.txt
   ```
6. Start X-Plane 12

### Option 2: Build from Source

1. Build the plugin (see Building section below)
2. Copy the built plugin to your X-Plane 12 `Resources/plugins/XBlackBox/` directory
3. The final structure should be:
   ```
   X-Plane 12/
   â””â”€â”€ Resources/
       â””â”€â”€ plugins/
           â””â”€â”€ XBlackBox/
               â”œâ”€â”€ 64/
               â”‚   â””â”€â”€ lin.xpl (or mac.xpl or win.xpl)
               â””â”€â”€ ...
   ```
4. Start X-Plane 12

## Building

### Requirements

- CMake 3.16 or later
- C++17 compatible compiler (GCC, Clang, MSVC)
- X-Plane SDK (included in `SDK/` directory)
- ImGui (included in `SDK/imgui-1.92.5/` directory)

### Build Steps

```bash
# Create build directory
mkdir build
cd build

# Configure
cmake ..

# Build
cmake --build . --config Release

# Install (copies to project root)
cmake --install .
```

### Platform-Specific Notes

**Windows**: Requires MSVC or MinGW. The plugin will be named `win.xpl`.

**macOS**: Requires Xcode command-line tools. The plugin will be named `mac.xpl`.

**Linux**: Requires GCC or Clang. The plugin will be named `lin.xpl`.

## Usage

### Menu Access

Access XBlackBox from the X-Plane menu bar:
**Plugins â†’ XBlackBox**

### Menu Options

- **Auto Mode**: Toggle automatic recording on/off
- **Start/Stop Recording**: Manually control recording
- **Recording Level**: Choose Simple, Normal, or Detailed
- **Recording Interval**: Set data capture frequency (0.05s to 5.0s)
- **Show Status**: Display current recording status
- **Open Output Folder**: Open the folder containing recorded files

### Recording Files

Recorded files are saved in:
```
X-Plane 12/Output/XBlackBox/flightdata_YYYYMMDD_HHMMSS.xdr
```

Files use the efficient `.xdr` (X-Plane Data Recorder) binary format.

## Configuration

Settings are automatically saved in:
```
X-Plane 12/Output/XBlackBox/config.ini
```

### Configurable Parameters

- **recordingLevel**: 1=Simple, 2=Normal, 3=Detailed (default: 3)
- **recordingInterval**: 0.05 to 5.0 seconds (default: 0.25)
- **autoMode**: true/false (default: false)
- **autoStartCondition**: "ground_speed", "engine_running", "weight_on_wheels"
- **autoStartThreshold**: threshold value (default: 5 knots for ground speed)
- **autoStopCondition**: same options as start
- **autoStopThreshold**: threshold value (default: 5 knots)
- **autoStopDelay**: delay in seconds before stopping (default: 30)

## Recorded Parameters

### Level 1: Simple (Basic Flight Data)

**Time & Aircraft Info**
- Total running time, Zulu time, Date
- Aircraft description, ICAO code

**Position**
- Latitude, Longitude
- Elevation MSL, Height AGL

**Attitude**
- Pitch, Roll, Heading (true & magnetic)
- Ground track, Sideslip angle, Angle of attack

**Velocities**
- IAS, TAS, Ground speed
- Vertical speed (fpm)
- Angular rates (P, Q, R)

**Forces**
- G-forces (normal, axial, side)

### Level 2: Normal (+ Controls & Systems)

**Flight Controls**
- Yoke pitch, roll, rudder pedals
- Parking brake, landing brake

**Control Surfaces**
- Aileron positions (left/right)
- Elevator, Rudder
- Flaps (request & actual)
- Speedbrake (request & actual)

**Landing Gear**
- Gear request & deployment status
- Tire rotation speeds
- Weight on wheels

**Engine Controls & Data**
- Throttle, Mixture, Prop pitch (up to 8 engines)
- Engine running status
- N1, N2 percentages
- Fuel flow, EGT, ITT, CHT, Torque

**Weight & Fuel**
- Total weight, Fuel weight
- Fuel quantity

### Level 3: Detailed (Everything)

**Autopilot**
- State, Mode
- Altitude, Heading, Airspeed, VS targets
- Flight director (mode, pitch, roll)

**Navigation & Radios**
- NAV1/2 frequencies & DME distance
- COM1/2 frequencies
- GPS distance

**Environment**
- Cabin altitude & vertical speed
- Outside air temperature
- Wind speed & direction (multiple layers)
- Barometric pressure

**Electrical System**
- Battery voltage & current (up to 8 batteries)
- Generator status

**Hydraulics**
- Hydraulic pressure (systems 1 & 2)

**Engine Details**
- Manifold pressure
- Oil pressure & temperature
- Cowl flap positions

**Warnings & Annunciators**
- Master warning/caution
- Stall warning
- Low vacuum, Low voltage
- Fuel quantity warning

**Ice & Anti-Ice**
- Frame anti-ice, Inlet heat, Pitot heat
- Ice accumulation levels

**Additional Forces & Moments**
- Aerodynamic forces (side, normal, axial)
- Roll, Pitch, Yaw moments

**Cockpit Switches & Lights**
- Battery switches (all batteries)
- Avionics master switch
- Landing lights, Beacon, Strobe lights
- Navigation lights, Taxi lights

**TCAS & Traffic**
- Number of TCAS targets

**Enhanced Autopilot Status**
- FMS VNAV mode
- Approach status (off/armed/captured)
- NAV status (off/armed/captured)

**System Failures Monitoring**
- Autopilot servo failures (aileron, elevator, rudder)
- Instrument failures (gyro, horizon, airspeed, altimeter)

**Engine Extended Parameters**
- Thrust reverser deployment
- Fuel burn status
- Fuel flow (kg/sec)
- Nacelle temperature

**Control Trim Settings**
- Elevator, Aileron, Rudder trim

**GPS Navigation Indicators**
- GPS DME distance
- GPS HDEF/VDEF deviation dots
- GPS course

**Weight & Center of Gravity**
- Payload weight
- Jettisoned weight
- Longitudinal CG position

**Performance Metrics**
- Local velocity components (X, Y, Z)
- True magnetic heading

**Weather Information**
- Visibility
- Cloud base, coverage, and type (3 layers)
- Sea level and ambient temperature

**Pressurization Controls**
- Safety valve position
- Dump valve status

**Replay Mode**
- Replay mode detection

## File Format

The `.xdr` format is a binary format optimized for:
- **Compact storage**: Efficient binary encoding
- **Fast I/O**: Sequential write with minimal overhead, buffered writes
- **Self-describing**: Contains metadata about recorded parameters
- **Platform-independent**: Little-endian byte order

### File Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ File Header      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Dataref Defs     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Data Frame 1     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Data Frame 2     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ...              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Data Frame N     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ File Footer      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

See the [XBlackBox-SASL repository](https://github.com/CCA3370/XBlackBox-SASL) for detailed file format specification and Python reader utility.

## Analyzing Recorded Data

### XDR Viewer - Enhanced Edition

The enhanced XDR Viewer provides powerful visualization and analysis capabilities:

**Installation:**
```bash
pip install -r requirements.txt
python xdr_viewer.py
```

**Key Features:**
- **Interactive Plotting**: Plot any parameter over time with zoom and pan
- **Statistics Analysis**: Automatic calculation of min/max/mean/median/std dev
- **Correlation Analysis**: Discover relationships between parameters
- **Derivative Mode**: Plot rate of change for any parameter
- **Time Range Selection**: Focus analysis on specific flight phases
- **Live Mode**: Monitor recordings in real-time as they're being written
- **Export**: Save to CSV or export plots as PNG/PDF/SVG

**Complete Documentation:** See [VIEWER_GUIDE.md](VIEWER_GUIDE.md) for detailed user guide.

### Command-Line Reader

For quick inspection and batch processing:

```bash
# View file summary
python xdr_reader.py recording.xdr

# Export to CSV
python xdr_reader.py recording.xdr --export output.csv

# Show all parameters
python xdr_reader.py recording.xdr --datarefs
```

## Performance Optimizations

This C++ implementation includes several optimizations over the SASL version:

1. **Buffered I/O**: 64KB write buffer with periodic flushing
2. **Efficient Dataref Access**: Cached dataref references, batch reading
3. **Native Performance**: C++ provides better performance than Lua
4. **Memory Efficiency**: Pre-allocated buffers, minimal allocations during recording
5. **Direct Binary Writing**: Optimized little-endian serialization

At default settings (4Hz, Detailed level):
- ~2KB per second of flight time
- ~7MB per hour of recording
- Negligible FPS impact (<0.1%)

## Development

Built with:
- X-Plane SDK (XPLM420)
- ImGui 1.92.5 for UI
- CMake build system
- C++17

## License

This project is licensed under the GPLv3 License - see the LICENSE file for details.

## Credits

- Developed for X-Plane 12
- Based on functionality from XBlackBox-SASL
- Uses X-Plane SDK by Laminar Research
- Uses Dear ImGui by Omar Cornut

## Support

For issues, questions, or contributions, please visit the project repository on GitHub.